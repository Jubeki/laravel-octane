{
	{$CADDY_GLOBAL_OPTIONS}

	frankenphp {
		worker {$APP_PUBLIC_PATH}/frankenphp-worker.php {$WORKER_COUNT}
	}

	log {
		level {$LOG_LEVEL:INFO}

		# Redact the authorization query parameter that can be set by Mercure...
		format filter {
			wrap console
			fields {
				uri query {
					replace authorization REDACTED
				}
			}
		}
	}
}

{$SERVER_NAME} {
	route {
		root * {$APP_PUBLIC_PATH}
		encode zstd gzip

		# Mercure configuration is injected here...
		{$CADDY_SERVER_EXTRA_DIRECTIVES}

		php_server {
			index frankenphp-worker.php
			# Required for the public/storage/ directory...
			resolve_root_symlink
		}
	}
}
